(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{406:function(e,t){},408:function(e,t){},417:function(e,t){},419:function(e,t){},444:function(e,t){},445:function(e,t){},643:function(e,t,n){"use strict";n.r(t);n(399),n(402),n(26),n(44),n(161),n(64);var r=n(19),o=n(280),l=n(241),c=n(546),f=n(374),d=(n(88),n(269)),v=(n(547),n(564)),m=n.n(v),h=n(548),y=n.n(h),svg=n(563),x=n.n(svg),w={props:{player:{type:f.Player,default:null}},data:function(){return{volume:1,progress:0,scale:.5,width:0}},computed:{notationTransform:function(){var e=this.width/2-(0===this.progress?0:this.player.tick*this.scale);return"transform: translateX(".concat(e,"px)")}},mounted:function(){var e=this,t=window.AudioContext||window.webkitAudioContext||!1,n=new t,r=function(e){return"Note on"===e.name&&e.velocity>0};this.player.getSongPercent=function(){return this.getCurrentTick()/this.division/this.tempo*60/this.getSongTime()*100},y.a.instrument(new t,"acoustic_grand_piano").then((function(t){e.player.on("playing",(function(){e.progress=Math.round(e.player.getSongPercent())}));var o=null;e.player.on("midiEvent",(function(l){r(l)&&(t.play(l.noteName,n.currentTime,{gain:l.velocity/100*e.volume}),o&&x.a.select(".tick".concat(o)).fill(m.a.indigo.base),x.a.select(".tick".concat(l.tick)).fill(m.a.lightBlue.base),o=l.tick)}))}));var o=this.player.getEvents().reduce((function(e,t){return e.push.apply(e,Object(d.a)(t)),e})).filter(r),l=function(e,t){return 7*(e.match(/\d/g)[0]-t.match(/\d/g)[0])+(e.charCodeAt(0)-t.charCodeAt(0))},c=null,f=null;o.forEach((function(e){(!c||l(c,e.noteName)<0)&&(c=e.noteName),(!f||l(f,e.noteName)>0)&&(f=e.noteName)}));for(var v=function(e,t){return 20*l(e,t)/2},h=this.player.totalTicks*this.scale,w=v(c,f)+40,k=x()("notation").size(h,w),_=v(c,"F5")+20,i=0;i<5;i++){var P=_+20*i;k.line(2,P,h-2,P).stroke({color:m.a.brown.base,width:4,linecap:"round"})}o.forEach((function(t){var n=t.tick*e.scale;k.text(t.noteName).attr("class","tick tick".concat(t.tick)).font({fill:m.a.indigo.base,size:20,style:"font-weight: bold"}).center(n,_-v(t.noteName,"F5"))})),this.width=this.$refs.container.clientWidth},methods:{play:function(){this.player.isPlaying()?this.player.pause():this.player.play()},stop:function(){this.player.stop(),this.progress=0},setProgress:function(e){var progress=e.offsetX/document.querySelector(".v-progress-linear").clientWidth*100;this.player.isPlaying()&&(this.player.skipToPercent(progress),this.player.play())}}},k=n(53),_=n(76),P=n.n(_),T=n(647),V=n(637),C=n(378),S=n(379),N=n(638),A=n(639),R=n(646),component=Object(k.a)(w,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"container",staticStyle:{"overflow-x":"hidden"}},[n("v-toolbar",{attrs:{flat:"",height:"90"}},[n("v-row",{attrs:{align:"center"}},[n("v-col",{attrs:{cols:5,align:"end"}},[n("v-btn",{attrs:{outlined:"",fab:"",small:"",color:"light-blue"},on:{click:e.stop}},[n("v-icon",[e._v("mdi-stop")])],1)],1),e._v(" "),n("v-col",{attrs:{cols:2,align:"center"}},[n("v-btn",{attrs:{outlined:"",fab:"",color:"light-blue"},on:{click:e.play}},[n("v-icon",{attrs:{large:""}},[e._v("\n            "+e._s(e.player.isPlaying()?"mdi-pause":"mdi-play")+"\n          ")])],1)],1),e._v(" "),n("v-col",{attrs:{cols:5}},[n("v-slider",{attrs:{"append-icon":"mdi-volume-high","prepend-icon":"mdi-volume-low",max:"10",step:"0.1"},model:{value:e.volume,callback:function(t){e.volume=t},expression:"volume"}})],1)],1)],1),e._v(" "),n("v-toolbar",{attrs:{flat:"",height:"60"}},[n("v-progress-linear",{attrs:{value:e.progress,height:"20",color:"light-blue"},on:{click:function(t){return e.setProgress(t)}}})],1),e._v(" "),n("div",{style:e.notationTransform,attrs:{id:"notation"}})],1)}),[],!1,null,null,null),U=component.exports;P()(component,{VBtn:T.a,VCol:V.a,VIcon:C.a,VProgressLinear:S.a,VRow:N.a,VSlider:A.a,VToolbar:R.a});var F={components:{PlayerComponent:U},asyncData:function(){return Object(r.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new o.OnsetsAndFrames("https://storage.googleapis.com/magentadata/js/checkpoints/transcription/onsets_frames_uni"),e.next=3,t.initialize();case 3:return e.abrupt("return",{model:t});case 4:case"end":return e.stop()}}),e)})))()},data:function(){var e=["Youtube URL","Audio file"];return{type:e[0],types:e,youtubeUrl:"",file:null,fileName:"",progress:"",isProcessing:!1,isSuccessful:!1,midi:null,messageDialog:!1,messageText:"",player:new f.Player}},computed:{isYoutube:function(){return this.type===this.types[0]}},methods:{process:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r,c,d,v,m,h,y,x,w,audio,k,_,data,P,T,V,C,i,S,N,A;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=function(e){t.messageText=e,t.messageDialog=!0,t.isSuccessful=!1,t.isProcessing=!1},t.fileName="",t.progress="reading",t.isProcessing=!0,t.isSuccessful=!1,t.midi=null,t.messageDialog=!1,t.messageText="",r=null,!t.isYoutube){e.next=31;break}c=null,e.prev=11,c=new URL(t.youtubeUrl),e.next=18;break;case 15:return e.prev=15,e.t0=e.catch(11),e.abrupt("return",n("Invalid URL"));case 18:return d=new URLSearchParams(c.search).get("v"),m="".concat(v="https://oggy.metalwhale.dev:8000","/youtube_audio?video_id=").concat(d),h="".concat(v,"/youtube_info?video_id=").concat(d),e.next=24,t.$axios.$get(m,{responseType:"blob"});case 24:return r=e.sent,e.next=27,t.$axios.$get(h);case 27:(y=e.sent).info&&(t.fileName=y.info.title),e.next=33;break;case 31:r=t.file,t.fileName=r.name.split(".")[0];case 33:return e.next=35,l.q(r);case 35:if(x=e.sent,w=new Uint8Array(x),"MThd"===f.Utils.bytesToLetters(w.subarray(0,4))){e.next=74;break}return audio=null,e.prev=39,e.next=42,l.p(x);case 42:audio=e.sent,e.next=48;break;case 45:return e.prev=45,e.t1=e.catch(39),e.abrupt("return",n("Error occurred while decoding"));case 48:if(!audio){e.next=72;break}k=audio.sampleRate,_=10*k,data=new Float32Array(_),P=new OfflineAudioContext(1,k,k),T=P.createBuffer(2,_,k),V=[],C=Math.ceil(audio.length/_),i=0;case 57:if(!(i<C)){e.next=69;break}for(S=i*_,t.progress="".concat(i+1,"/").concat(C," sequences"),N=0;N<audio.numberOfChannels;N++)audio.copyFromChannel(data,N,S),T.copyToChannel(data,N,0);return e.t2=V,e.next=64,t.model.transcribeFromAudioBuffer(T);case 64:e.t3=e.sent,e.t2.push.call(e.t2,e.t3);case 66:i++,e.next=57;break;case 69:A=o.sequences.concatenate(V),t.midi=o.sequenceProtoToMidi(A),x=t.midi.buffer;case 72:e.next=75;break;case 74:t.midi=w;case 75:t.player.loadArrayBuffer(x),t.isSuccessful=!0,t.isProcessing=!1;case 78:case"end":return e.stop()}}),e,null,[[11,15],[39,45]])})))()},save:function(){Object(c.saveAs)(new File([this.midi],"".concat(this.fileName,".mid")))}}},O=n(384),D=n(310),j=n(234),E=n(645),$=n(641),B=n(398),L=n(642),M=n(313),Y=Object(k.a)(F,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",[n("v-row",[n("v-col",{attrs:{cols:3}},[n("v-select",{attrs:{items:e.types},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}})],1),e._v(" "),n("v-col",{attrs:{cols:5}},[e.isYoutube?n("v-text-field",{model:{value:e.youtubeUrl,callback:function(t){e.youtubeUrl=t},expression:"youtubeUrl"}}):n("v-file-input",{attrs:{disabled:e.isProcessing},model:{value:e.file,callback:function(t){e.file=t},expression:"file"}})],1),e._v(" "),n("v-col",{attrs:{cols:2}},[n("v-btn",{attrs:{disabled:e.isProcessing},on:{click:e.process}},[e._v("\n        "+e._s(e.isProcessing?"Processing"+(e.progress?" ("+e.progress+")":""):"Process")+"\n      ")])],1),e._v(" "),n("v-col",{attrs:{cols:2}},[e.isSuccessful?n("v-btn",{on:{click:e.save}},[e._v("Save")]):e._e()],1)],1),e._v(" "),n("v-flex",[e.isSuccessful?n("player-component",{attrs:{player:e.player}}):e._e()],1),e._v(" "),n("v-dialog",{attrs:{"max-width":"300"},model:{value:e.messageDialog,callback:function(t){e.messageDialog=t},expression:"messageDialog"}},[n("v-card",[n("v-card-title",[e._v("Message")]),e._v(" "),n("v-card-text",[e._v(e._s(e.messageText))])],1)],1)],1)}),[],!1,null,null,null);t.default=Y.exports;P()(Y,{VBtn:T.a,VCard:O.a,VCardText:D.a,VCardTitle:D.b,VCol:V.a,VContainer:j.a,VDialog:E.a,VFileInput:$.a,VFlex:B.a,VRow:N.a,VSelect:L.a,VTextField:M.a})}}]);